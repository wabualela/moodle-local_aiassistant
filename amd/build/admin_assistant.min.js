/**
 * Admin assistant ID field handler
 *
 * @module     local_aiassistant/admin_assistant
 * @copyright  2025 Wail Abualela
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("local_aiassistant/admin_assistant",["jquery","core/ajax","core/notification"],(function($,Ajax,Notification){function fetchAssistantInfo(assistantId,container,loading){loading.style.display="block",container.style.display="none",Ajax.call([{methodname:"local_aiassistant_get_assistant_info",args:{assistantid:assistantId}}])[0].then((function(response){if(loading.style.display="none",response.success){let html='<h5><i class="fa fa-robot"></i> '+escapeHtml(response.name||"Unnamed Assistant")+"</h5>";if(response.description&&(html+="<p><strong>Description:</strong> "+escapeHtml(response.description)+"</p>"),html+="<p><strong>Model:</strong> "+escapeHtml(response.model||"N/A")+"</p>",response.tools>0&&(html+="<p><strong>Tools:</strong> "+response.tools+" configured</p>"),response.instructions){html+="<p><strong>Instructions:</strong> "+escapeHtml(response.instructions.length>200?response.instructions.substring(0,200)+"...":response.instructions)+"</p>"}container.innerHTML=html,container.className="alert alert-success",container.style.display="block"}else container.innerHTML='<i class="fa fa-exclamation-triangle"></i> '+escapeHtml(response.error||"Failed to fetch assistant info"),container.className="alert alert-danger",container.style.display="block"})).catch((function(error){loading.style.display="none",container.innerHTML='<i class="fa fa-exclamation-triangle"></i> '+escapeHtml(error.message||"An error occurred"),container.className="alert alert-danger",container.style.display="block",Notification.exception(error)}))}function escapeHtml(text){const div=document.createElement("div");return div.textContent=text,div.innerHTML}return{init:function(fieldId){const select=document.getElementById(fieldId),container=document.getElementById("assistant-info-container"),loading=document.getElementById("assistant-loading");select&&container&&loading&&(!function(select,infoContainer,loading){const currentValue=select.getAttribute("data-current-value")||"";Ajax.call([{methodname:"local_aiassistant_list_assistants",args:{}}])[0].then((function(response){if(window.console.log("Assistants list response:",response),loading.style.display="none",response.success&&response.assistants.length>0){select.innerHTML="";const emptyOption=document.createElement("option");emptyOption.value="",emptyOption.textContent="-- Select an assistant --",select.appendChild(emptyOption),response.assistants.forEach((function(assistant){const option=document.createElement("option");option.value=assistant.id,option.textContent=assistant.name+" ("+assistant.model+")",assistant.id===currentValue&&(option.selected=!0),select.appendChild(option)})),currentValue&&fetchAssistantInfo(currentValue,infoContainer,loading)}else{window.console.warn("Failed to fetch assistants:",response.error),select.innerHTML="";const option=document.createElement("option");option.value="",option.textContent=response.error||"No assistants found",select.appendChild(option),response.error&&(infoContainer.innerHTML='<i class="fa fa-exclamation-triangle"></i> '+escapeHtml(response.error),infoContainer.className="alert alert-warning",infoContainer.style.display="block")}})).catch((function(error){window.console.error("Error fetching assistants:",error),loading.style.display="none",select.innerHTML="";const option=document.createElement("option");option.value="",option.textContent="Error loading assistants",select.appendChild(option),infoContainer.innerHTML='<i class="fa fa-exclamation-triangle"></i> Error: '+escapeHtml(error.message||"Failed to load assistants"),infoContainer.className="alert alert-danger",infoContainer.style.display="block",Notification.exception(error)}))}(select,container,loading),select.addEventListener("change",(function(){const assistantId=select.value;container.style.display="none",assistantId&&fetchAssistantInfo(assistantId,container,loading)})))}}}));

//# sourceMappingURL=admin_assistant.min.js.map